<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskVoice - Voice Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(240 3.7% 15.9%)",
                        input: "hsl(240 3.7% 15.9%)",
                        ring: "hsl(240 4.9% 83.9%)",
                        background: "hsl(240 10% 3.9%)",
                        foreground: "hsl(0 0% 98%)",
                        primary: {
                            DEFAULT: "hsl(0 0% 98%)",
                            foreground: "hsl(240 5.9% 10%)",
                        },
                        secondary: {
                            DEFAULT: "hsl(240 3.7% 15.9%)",
                            foreground: "hsl(0 0% 98%)",
                        },
                        destructive: {
                            DEFAULT: "hsl(0 62.8% 30.6%)",
                            foreground: "hsl(0 0% 98%)",
                        },
                        muted: {
                            DEFAULT: "hsl(240 3.7% 15.9%)",
                            foreground: "hsl(240 5% 64.9%)",
                        },
                        accent: {
                            DEFAULT: "hsl(240 3.7% 15.9%)",
                            foreground: "hsl(0 0% 98%)",
                        },
                        popover: {
                            DEFAULT: "hsl(240 10% 3.9%)",
                            foreground: "hsl(0 0% 98%)",
                        },
                        card: {
                            DEFAULT: "hsl(240 10% 3.9%)",
                            foreground: "hsl(0 0% 98%)",
                        },
                    },
                    borderRadius: {
                        lg: "0.5rem",
                        md: "calc(0.5rem - 2px)",
                        sm: "calc(0.5rem - 4px)",
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.95); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: hsl(240 3.7% 15.9%);
        }
        
        ::-webkit-scrollbar-thumb {
            background: hsl(240 5% 26%);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: hsl(240 5% 34%);
        }
        
        body {
            background: hsl(240 10% 3.9%);
            color: hsl(0 0% 98%);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Task extraction function
        function extractTasksFromText(text) {
            const tasks = [];
            let normalizedText = text.trim();
            
            normalizedText = normalizedText.replace(/\s+and\s+then\s+/gi, '|||');
            normalizedText = normalizedText.replace(/\s+and\s+after\s+that\s+/gi, '|||');
            normalizedText = normalizedText.replace(/\s+then\s+/gi, '|||');
            normalizedText = normalizedText.replace(/\s+after\s+that\s+/gi, '|||');
            normalizedText = normalizedText.replace(/\s+also\s+/gi, '|||');
            normalizedText = normalizedText.replace(/\s+plus\s+/gi, '|||');
            normalizedText = normalizedText.replace(/\s+and\s+/gi, '|||');
            normalizedText = normalizedText.replace(/,\s+and\s+/gi, '|||');
            normalizedText = normalizedText.replace(/,\s+/g, '|||');
            normalizedText = normalizedText.replace(/;\s+/g, '|||');
            normalizedText = normalizedText.replace(/\.\s+/g, '|||');
            
            let segments = normalizedText.split('|||').filter(s => s.trim().length > 3);
            
            const actionWords = ['need to', 'have to', 'should', 'must', 'want to', 'going to', 'plan to', 'will', 'got to', 'gotta', 'gonna', 'supposed to'];
            const actionVerbs = ['call', 'email', 'send', 'buy', 'finish', 'complete', 'write', 'read', 'review', 'meet', 'schedule', 'book', 'order', 'prepare', 'check', 'update', 'create', 'make', 'do', 'get', 'take', 'go', 'attend', 'submit', 'deliver', 'draft', 'edit', 'contact', 'follow up', 'organize', 'plan', 'develop', 'design', 'implement', 'test', 'fix', 'resolve'];
            
            const timeKeywords = {
                morning: ['morning', 'am', 'breakfast', 'early', '8am', '9am', '10am', '11am'],
                afternoon: ['afternoon', 'lunch', 'noon', '12pm', '1pm', '2pm', '3pm', '4pm'],
                evening: ['evening', 'night', 'dinner', 'late', '5pm', '6pm', '7pm', '8pm', '9pm']
            };
            
            const urgencyKeywords = {
                high: ['urgent', 'asap', 'immediately', 'critical', 'important', 'must', 'deadline', 'today', 'right now', 'emergency'],
                medium: ['soon', 'should', 'need to', 'tomorrow', 'this week', 'by friday'],
                low: ['eventually', 'sometime', 'when possible', 'maybe', 'could', 'later', 'next week']
            };

            segments.forEach((segment, index) => {
                const trimmedSegment = segment.trim();
                const lowerSegment = trimmedSegment.toLowerCase();
                
                if (trimmedSegment.length < 3) return;
                
                const hasActionWord = actionWords.some(word => lowerSegment.includes(word));
                const hasActionVerb = actionVerbs.some(verb => {
                    const regex = new RegExp(`\\b${verb}\\b`, 'i');
                    return regex.test(lowerSegment);
                });
                
                if (hasActionWord || hasActionVerb || trimmedSegment.length > 8) {
                    let title = trimmedSegment;
                    
                    actionWords.forEach(word => {
                        const regex = new RegExp(`^(i\\s+)?(${word.replace(/\s+/g, '\\s+')})(\\s+i\\s+)?\\s*`, 'i');
                        title = title.replace(regex, '');
                    });
                    
                    title = title.replace(/^(i|to)\s+/i, '');
                    
                    if (title.length > 0) {
                        title = title.charAt(0).toUpperCase() + title.slice(1);
                    }
                    
                    if (title.length < 3) return;
                    
                    let suggestedTime = 'afternoon';
                    for (const [time, keywords] of Object.entries(timeKeywords)) {
                        if (keywords.some(kw => lowerSegment.includes(kw))) {
                            suggestedTime = time;
                            break;
                        }
                    }
                    
                    let priority = 'medium';
                    for (const [level, keywords] of Object.entries(urgencyKeywords)) {
                        if (keywords.some(kw => lowerSegment.includes(kw))) {
                            priority = level;
                            break;
                        }
                    }
                    
                    let estimatedDuration = 30;
                    if (lowerSegment.match(/\b(call|phone|ring)\b/)) {
                        estimatedDuration = 15;
                    } else if (lowerSegment.match(/\b(email|message|text)\b/)) {
                        estimatedDuration = 10;
                    } else if (lowerSegment.match(/\b(meeting|presentation|workshop)\b/)) {
                        estimatedDuration = 60;
                    } else if (lowerSegment.match(/\b(quick|brief|short)\b/)) {
                        estimatedDuration = 15;
                    } else if (lowerSegment.match(/\b(detailed|thorough|long|complete)\b/)) {
                        estimatedDuration = 60;
                    } else if (lowerSegment.match(/\b(review|read|check)\b/)) {
                        estimatedDuration = 20;
                    } else if (title.length > 50) {
                        estimatedDuration = 45;
                    }
                    
                    tasks.push({
                        id: Date.now() + index + Math.random() * 10000,
                        title: title.length > 70 ? title.substring(0, 67) + '...' : title,
                        description: trimmedSegment,
                        estimatedDuration,
                        priority,
                        suggestedTime,
                        completed: false,
                        scheduledDate: '',
                        scheduledTime: ''
                    });
                }
            });

            const uniqueTasks = [];
            const seenTitles = new Set();
            
            tasks.forEach(task => {
                const normalizedTitle = task.title.toLowerCase().trim().substring(0, 30);
                if (!seenTitles.has(normalizedTitle)) {
                    seenTitles.add(normalizedTitle);
                    uniqueTasks.push(task);
                }
            });

            return uniqueTasks;
        }

        // Icons
        const MicrophoneIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
        );

        const StopIcon = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <rect x="7" y="7" width="10" height="10" rx="1" />
            </svg>
        );

        const ClockIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const SunIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        );

        const CalendarIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const TrashIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const CheckIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
            </svg>
        );

        const SparklesIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
            </svg>
        );

        const ArrowLeftIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
        );

        const ListIcon = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
            </svg>
        );

        // Voice Input Screen
        function VoiceInputScreen({ onGenerateTasks, transcript, setTranscript, existingTasksCount, onViewTasks }) {
            const [isRecording, setIsRecording] = useState(false);
            const [currentText, setCurrentText] = useState('');
            const [error, setError] = useState('');
            const [speechSupported, setSpeechSupported] = useState(true);
            const recognitionRef = useRef(null);

            useEffect(() => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    setSpeechSupported(false);
                    setError('Speech recognition not supported. Please use Chrome, Edge, or Safari.');
                }
            }, []);

            const startRecording = useCallback(() => {
                setError('');
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

                if (!SpeechRecognition) {
                    setError('Speech recognition not supported');
                    return;
                }

                const recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = () => {
                    setIsRecording(true);
                };

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const result = event.results[i];
                        if (result.isFinal) {
                            finalTranscript += result[0].transcript + ' ';
                        } else {
                            interimTranscript += result[0].transcript;
                        }
                    }

                    if (finalTranscript) {
                        setTranscript(prev => prev + finalTranscript);
                    }
                    setCurrentText(interimTranscript);
                };

                recognition.onerror = (event) => {
                    if (event.error === 'not-allowed') {
                        setError('Microphone access denied. Please allow microphone access.');
                    } else if (event.error === 'no-speech') {
                        // Silent error
                    } else {
                        setError(`Error: ${event.error}`);
                    }
                };

                recognition.onend = () => {
                    if (recognitionRef.current && isRecording) {
                        try {
                            recognition.start();
                        } catch (e) {
                            // Ignore
                        }
                    } else {
                        setIsRecording(false);
                    }
                };

                recognitionRef.current = recognition;

                try {
                    recognition.start();
                } catch (e) {
                    setError('Failed to start recording.');
                }
            }, [isRecording, setTranscript]);

            const stopRecording = useCallback(() => {
                if (recognitionRef.current) {
                    recognitionRef.current.stop();
                    recognitionRef.current = null;
                }
                setIsRecording(false);
                setCurrentText('');
            }, []);

            const toggleRecording = () => {
                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <header className="border-b border-border">
                        <div className="container mx-auto px-4 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="h-8 w-8 rounded-lg bg-primary text-primary-foreground flex items-center justify-center font-bold text-sm">
                                    TV
                                </div>
                                <span className="font-semibold text-lg">TaskVoice</span>
                            </div>
                            {existingTasksCount > 0 && (
                                <button
                                    onClick={onViewTasks}
                                    className="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
                                >
                                    <ListIcon className="w-4 h-4 mr-2" />
                                    My Tasks
                                    <span className="ml-2 inline-flex items-center justify-center rounded-full bg-primary text-primary-foreground px-2 py-0.5 text-xs font-semibold">
                                        {existingTasksCount}
                                    </span>
                                </button>
                            )}
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 container mx-auto px-4 py-12 max-w-3xl">
                        <div className="space-y-8">
                            {/* Title Section */}
                            <div className="text-center space-y-2">
                                <h1 className="text-4xl font-bold tracking-tight">Speak Your Tasks</h1>
                                <p className="text-muted-foreground text-lg">
                                    Convert your voice into organized, actionable tasks
                                </p>
                            </div>

                            {/* Error Display */}
                            {error && (
                                <div className="rounded-lg border border-destructive/50 bg-destructive/10 px-4 py-3 text-sm text-destructive">
                                    {error}
                                </div>
                            )}

                            {/* Microphone Section */}
                            <div className="flex flex-col items-center gap-6 py-8">
                                <div className="relative">
                                    {isRecording && (
                                        <>
                                            <div className="absolute inset-0 rounded-full bg-red-500 pulse-ring opacity-40"></div>
                                            <div className="absolute inset-0 rounded-full bg-red-500 pulse-ring opacity-40" style={{ animationDelay: '0.75s' }}></div>
                                        </>
                                    )}
                                    <button
                                        onClick={toggleRecording}
                                        disabled={!speechSupported}
                                        className={`relative h-24 w-24 rounded-full transition-all duration-200 ${
                                            isRecording
                                                ? 'bg-red-600 hover:bg-red-700 scale-105'
                                                : 'bg-primary text-primary-foreground hover:bg-primary/90'
                                        } disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center shadow-lg`}
                                    >
                                        {isRecording ? (
                                            <StopIcon className="h-10 w-10" />
                                        ) : (
                                            <MicrophoneIcon className="h-10 w-10" />
                                        )}
                                    </button>
                                </div>
                                
                                <div className="text-center">
                                    <p className={`text-sm font-medium ${isRecording ? 'text-red-500' : 'text-muted-foreground'}`}>
                                        {isRecording ? '‚óè Recording in progress...' : 'Click to start recording'}
                                    </p>
                                </div>
                            </div>

                            {/* Live Transcript */}
                            {currentText && (
                                <div className="rounded-lg border border-border bg-card p-4">
                                    <p className="text-xs font-medium text-muted-foreground mb-2">LISTENING...</p>
                                    <p className="text-sm italic text-foreground/80">{currentText}</p>
                                </div>
                            )}

                            {/* Transcript Textarea */}
                            <div className="space-y-2">
                                <label className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                                    Your Conversation
                                </label>
                                <textarea
                                    value={transcript}
                                    onChange={(e) => setTranscript(e.target.value)}
                                    placeholder={speechSupported
                                        ? "Your spoken words will appear here... Or type directly"
                                        : "Voice input not supported. Please type your tasks here"}
                                    className="flex min-h-[160px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"
                                />
                            </div>

                            {/* Generate Button */}
                            <button
                                onClick={onGenerateTasks}
                                disabled={!transcript.trim()}
                                className="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-11 px-8 w-full"
                            >
                                <SparklesIcon className="w-4 h-4 mr-2" />
                                Generate Tasks
                            </button>

                            {/* Help Text */}
                            <p className="text-center text-xs text-muted-foreground">
                                Try: "Call John tomorrow, send the report by Friday, and schedule a team meeting"
                            </p>
                        </div>
                    </main>
                </div>
            );
        }

        // Task Card Component
        function TaskCard({ task, onUpdate, onDelete }) {
            const priorityStyles = {
                high: 'border-red-500/50 bg-red-500/5',
                medium: 'border-yellow-500/50 bg-yellow-500/5',
                low: 'border-blue-500/50 bg-blue-500/5'
            };

            const priorityBadgeStyles = {
                high: 'bg-red-500/10 text-red-500 border-red-500/20',
                medium: 'bg-yellow-500/10 text-yellow-500 border-yellow-500/20',
                low: 'bg-blue-500/10 text-blue-500 border-blue-500/20'
            };

            const isScheduled = task.scheduledDate && task.scheduledTime;

            return (
                <div className={`rounded-lg border ${priorityStyles[task.priority]} p-4 transition-all hover:shadow-md ${task.completed ? 'opacity-60' : ''}`}>
                    <div className="flex items-start gap-3">
                        {/* Checkbox */}
                        <button
                            onClick={() => onUpdate({ ...task, completed: !task.completed })}
                            className={`mt-0.5 h-5 w-5 rounded border-2 flex items-center justify-center transition-all ${
                                task.completed
                                    ? 'bg-primary border-primary'
                                    : 'border-muted-foreground hover:border-primary'
                            }`}
                        >
                            {task.completed && <CheckIcon className="h-3 w-3 text-primary-foreground" />}
                        </button>

                        {/* Content */}
                        <div className="flex-1 space-y-3">
                            <div className="flex items-start justify-between gap-2">
                                <h3 className={`font-semibold leading-tight ${task.completed ? 'line-through text-muted-foreground' : ''}`}>
                                    {task.title}
                                </h3>
                                <span className={`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors ${priorityBadgeStyles[task.priority]}`}>
                                    {task.priority}
                                </span>
                            </div>

                            <p className={`text-sm text-muted-foreground ${task.completed ? 'line-through' : ''}`}>
                                {task.description}
                            </p>

                            {/* Meta Info */}
                            <div className="flex flex-wrap gap-3 text-xs text-muted-foreground">
                                <span className="inline-flex items-center gap-1">
                                    <ClockIcon className="h-3 w-3" />
                                    {task.estimatedDuration}min
                                </span>
                                <span className="inline-flex items-center gap-1">
                                    <SunIcon className="h-3 w-3" />
                                    {task.suggestedTime}
                                </span>
                            </div>

                            {/* Schedule Inputs */}
                            <div className="flex flex-wrap gap-2 items-center">
                                <input
                                    type="date"
                                    value={task.scheduledDate || ''}
                                    onChange={(e) => onUpdate({ ...task, scheduledDate: e.target.value })}
                                    className="flex h-9 w-auto rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"
                                />
                                <input
                                    type="time"
                                    value={task.scheduledTime || ''}
                                    onChange={(e) => onUpdate({ ...task, scheduledTime: e.target.value })}
                                    className="flex h-9 w-auto rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:
